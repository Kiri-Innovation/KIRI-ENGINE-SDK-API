# KIRI ENGINE API 

## Get your API keys

This is the API reference for programmatically interacting with KIRI Engine.

## Overview

The KIRI Engine API is a RESTful API that allows you to programmatically interact with KIRI Engine. You can use it to
create and retrieve tasks generated by KIRI Engine in your own applications.

**Base URL** 

To get started, you need to know the base URL for the KIRI Engine API endpoints:

```java
https://api.kiriengine.app/api/
```

## Quickstart

A few resources to help you get started with KIRI Engine APl:

- You need to create a KIRI Engine Developer account before using KIRI Engine API. Create an KIRI Engine Developer account <u>here</u>
- You need an API token to get verifed. Read the [Create API Key](#token) section to learn how to get API Tokens.
- Read the [Using API Token](#using) section to learn how to authenticate your requests with the API keys. 

## Authentication


### <span id="token">Creating API Keys</span>

After account registration, use the "Get Token" API to obtain a token and access KIRI Engine services.

[Create an API key in the API settings page here](https://www.kiriengine.app), which you'll use to securely [authenticate your requests](https://www.kiriengine.app). The API Key format is `kiri-<random-string>`.

Once you've generated an API Key, keep it stored securely.

### <span id="using">Using API Token</span>

Once you have created an API Key, you can use it to authenticate your requests to the KIRI Engine API. Pass your API Key in the `Authorization` header. An example header is shown below.

```shell
{
  "Authorization": "Bearer YOUR_API_KEY"
}
```

##  Photo Scan

### Video Upload
You can upload a video to use the **Photogrammetry** algorithm. The video resolution must not exceed 1920x1080, and the duration should be no longer than **3 minutes**.

**Request**

```shell
curl --location --request POST 'https://api.kiriengine.app/api/v1/open/photo/video' \
--header 'Authorization: Bearer ${YOUR_API_KEY}'\
--form 'videoFile=@"/file/video.mp4"' \
--form 'modelQuality=""1' \
--form 'textureQuality="1"' \
--form 'fileFormat="OBJ"' \
--form 'isMask="1"'\
--form 'textureSmoothing="1"'
```
**Response**

```json
{
    "code": 0,
    "msg": "success",
    "data": {
        "serialize": "796a6f52457844b4918db3eadd64becc",
        "calculateType":1
    },
    "ok": true
}
```
**Attributes**

| properties    | type    | description |
| :-------- | :-----  |:----:  |
| videoFile | File | Video files |
| modelQuality | Integer | Default: 0 (0: High, 1: Medium, 2: Low, 3: Ultra) |
| textureQuality | Integer | Default: 0 (0: 4K, 1: 2K, 2: 1K, 3: 8K) |
| ifMask | Integer |Default: 0 (0: Turn off Auto Object Masking, 1: Turn on Auto Object Masking)|
| serialize|String|Unique identifier for the task |
| calculateType |Integer|1: Photo Scan, 2: Featureless Object Scan, 3: 3DGS Scan |
| textureSmoothing |Integer|Default: 0: Turn off Texture Smoothing, 1: Turn on Texture Smoothing (Texture Smoothing improves the texture quality of blurry areas and produces more coherent texture maps. It may also reduce the overall sharpness of the textures. It's recommended to turn this off when when using for professional use that requires precise Photo Scans) |
| fileFormat |String|Generated model format (obj, fbx, stl, ply, glb, gltf, usdz, xyz) |

### Image Upload 

Use this API to upload a photoset to the KIRI Engine server and obtain the serial number of the model. This serial number is unique to this project.

To ensure consistency in the 3D models, please upload at least **20 images** but no more than **300 images**. If you need to upload more, please contact us.

**Request**

```shell
curl --location --request POST 'https://api.kiriengine.app/api/v1/open/photo/image' \
--header 'Authorization: Bearer ${YOUR_API_KEY}'\
--form 'imagesFiles=@""' \
--form 'modelQuality=""1' \
--form 'textureQuality="1"' \
--form 'fileFormat="OBJ"' \
--form 'isMask="1"'\
--form 'textureSmoothing="1"'
```
**Response**

```json
 {
    "code": 0,
    "msg": "success",
    "data": {
        "serialize": "796a6f52457844b4918db3eadd64becc",
        "calculateType":1
    },
    "ok": true
}
```
**Attributes**

| properties    | type    | description |
| :-------- | :-----  |:----:  |
| imagesFiles | Array | Image files |
| modelQuality | Integer | Default: 0 (0: High, 1: Medium, 2: Low, 3: Ultra) |
| textureQuality | Integer | Default: 0 (0: 4K, 1: 2K, 2: 1K, 3: 8K) |
| ifMask | Integer |Default: 0 (0: Turn off Auto Object Masking, 1: Turn on Auto Object Masking)|
| serialize|String|Unique identifier for the task |
| calculateType |Integer|1: Photo Scan, 2: Featureless Object Scan, 3: 3DGS Scan |
| textureSmoothing |Integer|Default: 0: Turn off Texture Smoothing, 1: Turn on Texture Smoothing (Texture Smoothing improves the texture quality of blurry areas and produces more coherent texture maps. It may also reduce the overall sharpness of the textures. It's recommended to turn this off when when using for professional use that requires precise Photo Scans) |
| fileFormat |String|Generated model format (obj, fbx, stl, ply, glb, gltf, usdz, xyz) |







## Featureless Object Scan

### Video Upload
You can upload a video to use the **Featureless** algorithm. The video resolution must not exceed **1920x1080**, and the duration should be no longer than **3 minutes**.

**Request**

```shell 
curl --location --request POST 'https://api.kiriengine.app/api/v1/open/featureless/video' \
--header 'Authorization: Bearer ${YOUR_API_KEY}'\
--form 'fileFormat="OBJ"' \
--form 'videoFile=@"/file/video.mp4"'
```

**Response**

```json
{
    "code": 0,
    "msg": "success",
    "data": {
        "serialize": "796a6f52457844b4918db3eadd64becc",
        "calculateType":2
    },
    "ok": true
}
```

**Attributes**

| properties    | type   |                  description                  |
| :------------ | :----- | :-------------------------------------------: |
| videoFile     | File   |                  Video file                   |
| serialize     | String |        Unique identifier for the task         |
| calculateType | Integer | 1: Photo Scan, 2: Featureless Object Scan, 3: 3DGS Scan |
| fileFormat |String|Generated model format (obj, fbx, stl, ply, glb, gltf, usdz, xyz) |
### Image Upload
Use this API to upload a photoset to the KIRI Engine server and obtain the serial number of the model. This serial number is unique to this project.

To ensure consistency in the 3D models, please upload at least **20 images** but no more than **300 images**. If you need to upload more, please contact us.

**Request**

```shell 
curl --location --request POST 'https://api.kiriengine.app/api/v1/open/featureless/image' \
--header 'Authorization: Bearer ${YOUR_API_KEY}'\
--form 'fileFormat="OBJ"' \
--form 'imagesFiles=@""'
```

**Response**

```json
{
    "code": 0,
    "msg": "success",
    "data": {
        "serialize": "796a6f52457844b4918db3eadd64becc",
        "calculateType":2
    },
    "ok": true
}
```

**Attributes**

| properties    | type   |                  description                  |
| :------------ | :----- | :-------------------------------------------: |
| imagesFiles   | Array |                  Image files                  |
| serialize     | String | Unique identifier for the task |
| calculateType | Integer | 1: Photo Scan, 2: Featureless Object Scan, 3: 3DGS Scan |
| fileFormat |String|Generated model format (obj, fbx, stl, ply, glb, gltf, usdz, xyz) |



## 3DGS Scan

### Video Upload
You can upload a video to use the **3D Gaussian Splatting** algorithm. The video resolution must not exceed **1920x1080**, and the duration should be no longer than **3 minutes**.

**Request**

```shell 
curl --location --request POST 'https://api.kiriengine.app/api/v1/open/3dgs/video' \
--header 'Authorization: Bearer ${YOUR_API_KEY}'\
--form 'isMesh="0"'\
--form 'isMask="0"'\
--form 'videoFile=@"/file/video.mp4"'
```

**Response**

```json
{
    "code": 0,
    "msg": "success",
    "data": {
        "serialize": "796a6f52457844b4918db3eadd64becc",
        "calculateType":3
    },
    "ok": true
}
```

**Attributes**

| properties    | type    |                         description                          |
| :------------ | :------ | :----------------------------------------------------------: |
| videoFile     | File    |                          Video file                          |
| serialize     | String  |                Unique identifier for the task                |
| calculateType | Integer |   1: Photo Scan, 2: Featureless Object Scan, 3: 3DGS Scan    |
| isMesh        | Integer | Default: 0: Turn off 3DGS to Mesh, 1: Turn on 3DGS to Mesh (3DGS projects are generated and stored as special PLY files. Turning on this feature will generate a separate mesh file) |
| isMask        | Integer | Default: 0: Turn off Auto Masking, 1: Turn on Auto Object Masking |
| fileFormat    | String  | With 3DGS to Mesh turned on, the available file formats for generation: obj, fbx, stl, ply, glb, gltf, usdz, xyz |


### Image Upload 
Use this API to upload a photoset to the KIRI Engine server and obtain the serial number of the model. This serial number is unique to this project.

To ensure consistency in the 3D models, please upload at least **20 images** but no more than **300 images**. If you need to upload more, please contact us.



**Request**

```shell 
curl --location --request POST 'https://api.kiriengine.app/api/v1/open/3dgs/image' \
--header 'Authorization: Bearer ${YOUR_API_KEY}'\
--form 'isMesh="0"'\
--form 'isMask="0"'\
--form 'imagesFiles=@""'
```

**Response**

```json
{
    "code": 0,
    "msg": "success",
    "data": {
        "serialize": "796a6f52457844b4918db3eadd64becc",
        "calculateType":3
    },
    "ok": true
}
```

**Attributes**

| properties    | type    |                         description                          |
| :------------ | :------ | :----------------------------------------------------------: |
| imagesFiles   | Array   |                         Image files                          |
| serialize     | String  |                Unique identifier for the task                |
| calculateType | Integer |   1: Photo Scan, 2: Featureless Object Scan, 3: 3DGS Scan    |
| isMesh        | Integer | Default: 0: Turn off 3DGS to Mesh, 1: Turn on 3DGS to Mesh (3DGS projects are generated and stored as special PLY files. Turning on this feature will generate a separate mesh file) |
| isMask        | Integer | Default: 0: Turn off Auto Masking, 1: Turn on Auto Object Masking |
| fileFormat    | String  | With 3DGS to Mesh turned on, the available file formats for generation: obj, fbx, stl, ply, glb, gltf, usdz, xyz |



## Model 

###   Retrieve 3D Model Status

Pass the serial number to this API to retrieve the current calculation status of the 3D model.

**Request**

```shell
curl --location --request GET 'https://api.kiriengine.app/api/v1/open/model/getStatus?serialize=796a6f52457844b4918db3eadd64becc' \
--header 'Authorization: Bearer ${YOUR_API_KEY}'\
```

**Response**

```json
{
    "code": 0,
    "msg": "success",
    "data": {
        "serialize":"796a6f52457844b4918db3eadd64becc",
        "status":2
    },
    "ok": true
}
```

**Attributes**

| Status | description |
| ------ | ----------- |
| -1     | Uploading   |
| 0      | Processing  |
| 1      | Failed      |
| 2      | Successful  |
| 3      | Queuing     |
| 4      | Exported    |

###  Download 3D Models (Zipped)

Use this API to obtain the download link for the zipped 3D model file. The link will be valid for 60 minutes.

**Request**

```shell
curl --location --request GET 'https://api.kiriengine.app/api/v1/open/model/getModelZip?serialize=796a6f52457844b4918db3eadd64becc' \
--header 'Authorization: Bearer ${YOUR_API_KEY}'\
```

**Response**

```json
{
    "code": 0,
    "msg": "success",
    "data": {
        "modelUrl":"xxx",
      	"serialize":"796a6f52457844b4918db3eadd64becc"
    },
    "ok": true
}
```

**Attributes**

| properties | type   |        description         |
| :--------- | :----- | :------------------------: |
| modelUrl   | String | Zipped Model download link |

## Get Balance

The Balance API allows you to retrieve the current credit balance for your account. This API provides a simple way to check your available credits, which are used for various KIRI Engine API services.

**Request**

```shell
curl --location --request GET 'https://api.kiriengine.app/api/v1/open/balance' \
--header 'Authorization: Bearer ${YOUR_API_KEY}'
```

**Response**

```json
{
    "code": 0,
    "msg": "success",
    "data": {
    "balance": 20
    },
    "ok": true
}
```

**Attributes**
| properties | type   |        description         |
| :--------- | :----- | :------------------------: |
| balance   | Integer | credit balance |

## Webhooks

When a model status change occurs on the KIRI Engine server, a POST request with event-specific JSON data is sent to the configured URL. A 200 response is required for successful capture. If the initial attempt fails, up to three retries will be made using exponential backoff.

### Creating Webhooks

Webhooks require three elements to function:

1. Webhooks can be set up and managed from Settings » Webhooks in your dashboard or programatically using the KIRI Engine API.

2. Callback URL

   This is the URL where KIRI Engine will sent a `POST` request when a model's status changes.

3. Signing secret

   This is a secret (typically a random string) between 6 and 40 characters used to sign each request. You should validate each incoming webhook against this secret to verify that the request came from KIRI.

![Group 2168](/Users/xinzhi/Downloads/Group 2168.png)

**Important Notes**:

**1. Please make sure the NotifyUrl can be accessed.** 

**2. Please make sure to use the POST method and JSON format to receive the 'status' and 'serialize' data.** 

**3、Please return HTTP 200 to our server upon receiving the notification.**



## Errors

In this guide, we will discuss what happens when errors occur while working with the KIRI Engine API.

KIRI uses standard HTTP response codes to indicate the success or failure of an API request:

-  `2xx` codes indicate a successful request.
-  `4xx` codes indicate a client error, such as missing parameters or invalid model data.
-  `5xx` codes indicate a server error on KIRI’s end, which should be rare.

------

## Status code

Here is a list of the different categories of status codes returned by the KIRI Engine API. Use these to understand if a request was successful.

- `2xx`

   <u>A 2xx status code indicates a successful response.</u>

  `200 - OK`

  <u>By default if everything worked as expected a 200 status code will be returned.</u>

- `4xx`

  <u>A 4xx status code indicates a client error, this indicates the issue is on the user's end..</u>

  `400 - Bad Request`

  <u>The request was unacceptable, often due to a missing mandatory parameter or a malformed parameter.</u>

  `401 - Unauthorized`

  <u>No valid API Key provided or the API Key provided is not authorized to access the KIRI Engine API endpoint.</u>

  `403 - Request Forbidden`

  <u>The user does not have enough credit.</u>

  `404 - Not Found`

  <u>The requested resource doesn't exist.</u>

- `5xx`

   <u>A 5xx status code indicates a server error. For detailed information on the specific error, refer to the code field returned.</u>
## 500 Code Details

| Code | Description                                                  |
| ---- | ------------------------------------------------------------ |
| 2000 | This model is processing, please wait.                       |
| 2001 | This model failed to generate. Unable to create download link. |
| 2002 | This model has already been exported. Unable to create download link. |
| 2003 | Error: unable to retrieve the status of this model.          |
| 2004 | The uploaded photoset is empty, please verify the source material. |
| 2005 | The photos uploaded exceeded the maximum limit.              |
| 2006 | This model does not exist. Please check the serial number.   |
| 2007 | The number of images uploaded is insufficient. Please upload at least 20 images. |
| 2008 | The model is currently in the processing queue. Please wait. |
| 2009 | The video does not meet the requirements and cannot be uploaded. |
| 2010 | The file format does not meet the requirements.              |
